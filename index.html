<!DOCTYPE html>
<html lang="ko">
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-H2GV4HDM4X"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-H2GV4HDM4X');
</script>
<head>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4113431418405246" crossorigin="anonymous"></script>
    <meta name="google-site-verification" content="nUa6YGTaqpapkvkL1DeAYbZKcBftyoTU7Y6AKpW-FZs" />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>니케 모듈작 시뮬레이션 | NIKKE Over Load Module Simulator</title>

    <!-- SEO Meta Tags -->
    <meta name="description" content="니케(NIKKE) 오버로드 모듈 시뮬레이터. 장비 개조 확률과 효과를 시뮬레이션하세요. 커스텀 모드로 원하는 옵션 조합을 테스트하고 모듈 비용을 계산할 수 있습니다. | NIKKE Over Load Module Simulator - Test equipment modifications, calculate module costs, and optimize your builds.">
    <meta name="keywords" content="니케, NIKKE, 모듈작, 오버로드, 시뮬레이터, 장비 개조, 모듈 시뮬레이션, Over Load, Module, Simulator, Equipment Modification, 勝利の女神:NIKKE, モジュール, シミュレーター, 模組, 模擬器">
    <meta name="author" content="NIKKE Module Simulator">
    <meta name="robots" content="index, follow">
    <meta name="language" content="Korean, Japanese, Chinese, English">

    <!-- Open Graph Meta Tags -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="니케 모듈작 시뮬레이션 | NIKKE Over Load Module Simulator">
    <meta property="og:description" content="니케(NIKKE) 오버로드 모듈 시뮬레이터로 장비 개조 효과를 테스트하고 최적의 빌드를 찾아보세요. 커스텀 모드 지원, 4개 언어 지원.">
    <meta property="og:site_name" content="NIKKE Module Simulator">
    <meta property="og:locale" content="ko_KR">
    <meta property="og:locale:alternate" content="ja_JP">
    <meta property="og:locale:alternate" content="zh_TW">
    <meta property="og:locale:alternate" content="en_US">

    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="니케 모듈작 시뮬레이션 | NIKKE Over Load Module Simulator">
    <meta name="twitter:description" content="니케(NIKKE) 오버로드 모듈 시뮬레이터로 장비 개조 효과를 테스트하고 최적의 빌드를 찾아보세요.">

    <!-- Additional Meta Tags -->
    <meta name="theme-color" content="#007bff">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">

    <!-- Structured Data (JSON-LD) -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "NIKKE Over Load Module Simulator",
        "alternateName": "니케 모듈작 시뮬레이션",
        "description": "Simulator for NIKKE Over Load module system. Test equipment modifications, calculate module costs, and optimize your builds with custom mode support.",
        "url": "https://nikkemodule.com",
        "applicationCategory": "GameApplication",
        "operatingSystem": "Web Browser",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD"
        },
        "inLanguage": ["ko", "ja", "zh-TW", "en"],
        "featureList": [
            "Equipment modification simulation",
            "Custom mode for testing builds",
            "Multi-language support (Korean, Japanese, Chinese, English)",
            "Dark mode theme",
            "Module cost calculation",
            "High-tier option protection"
        ]
    }
    </script>

    <style>
        :root {
            --bg-primary: #f8f9fa;
            --bg-secondary: white;
            --bg-card: white;
            --text-primary: #333;
            --text-secondary: #666;
            --border-color: #e9ecef;
            --shadow: rgba(0,0,0,0.04);
            --input-bg: white;
            --input-border: black;
            --summary-bg: #f8f9fa;
        }

        [data-theme="dark"] {
            --bg-primary: #1a1a1a;
            --bg-secondary: #2d2d2d;
            --bg-card: #2d2d2d;
            --text-primary: #e0e0e0;
            --text-secondary: #a0a0a0;
            --border-color: #404040;
            --shadow: rgba(0,0,0,0.3);
            --input-bg: #2d2d2d;
            --input-border: #555;
            --summary-bg: #242424;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-primary);
            min-height: 100vh;
            padding: 60px 40px;
            transition: background-color 0.3s ease;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            position: relative;
        }

        .title {
            text-align: center;
            font-size: 36px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 60px;
            letter-spacing: -0.5px;
            transition: color 0.3s ease;
        }

        .grid-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
        }

        .card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 2px 8px var(--shadow);
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }

        .card-content {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
            width: 100%;
            justify-content: center;
        }

        .center-square {
            width: 120px;
            height: 120px;
            background-color: var(--input-bg);
            border: 2px solid var(--input-border);
            border-radius: 8px;
            flex-shrink: 0;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }

        .text-lines {
            display: flex;
            flex-direction: column;
            gap: 8px;
            flex: 1;
            max-width: 240px;
        }

        .text-line {
            height: 28px;
            width: 240px;
            background-color: var(--input-bg);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 28px 0 16px;
            font-size: 14px;
            color: var(--text-secondary);
            font-weight: 500;
            border: 2px solid var(--input-border);
            position: relative;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease;
        }
        
        .lock-icon {
            position: absolute;
            right: 8px;
            width: 16px;
            height: 16px;
            cursor: pointer;
            transition: opacity 0.2s ease;
        }
        
        .lock-icon:hover {
            opacity: 0.7;
        }

        .button-container {
            display: flex;
            gap: 12px;
        }

        .button {
            width: 100px;
            height: 36px;
            border: none;
            border-radius: 6px;
            color: white;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .effect-btn {
            background-color: #007bff;
        }

        .reset-btn {
            background-color: #28a745;
        }

        .effect-btn:hover {
            background-color: #0056b3;
        }

        .effect-btn:active {
            background-color: #004085;
        }

        .reset-btn:hover {
            background-color: #1e7e34;
        }

        .reset-btn:active {
            background-color: #155724;
        }

        .modify-btn {
            background-color: #6c757d;
            width: 100px;
            height: 36px;
            border: none;
            border-radius: 6px;
            color: white;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .modify-btn:hover {
            background-color: #545b62;
        }

        .modify-btn:active {
            background-color: #495057;
        }

        .button-container {
            display: none;
        }

        .modify-container {
            width: 100px;
            display: block;
        }

        .card.expanded .button-container {
            display: flex;
        }

        .card.expanded .modify-container {
            display: none;
        }

        /* 커스텀 모드일 때 버튼 숨김 */
        .custom-mode .modify-container,
        .custom-mode .button-container {
            display: none !important;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            body {
                padding: 20px 16px;
            }
            
            .grid-container {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .title {
                font-size: 24px;
                margin-bottom: 20px;
            }
            
            .module-counter {
                font-size: 16px !important;
                margin-bottom: 16px !important;
            }
            
            .option-summary {
                margin-bottom: 24px !important;
                padding: 16px !important;
            }
            
            .option-summary div:first-child {
                font-size: 14px !important;
                margin-bottom: 12px !important;
            }
            
            .card {
                padding: 16px;
            }
            
            .card-content {
                flex-direction: column;
                gap: 16px;
                align-items: center;
            }
            
            .center-square {
                width: 80px;
                height: 80px;
            }
            
            .text-lines {
                max-width: 100%;
                width: 100%;
            }
            
            .text-line {
                height: 32px;
                width: 100%;
                font-size: 12px;
                padding: 0 24px 0 8px;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }
            
            .button-container {
                flex-direction: row;
                gap: 8px;
                width: 100%;
                justify-content: space-between;
            }
            
            .button {
                flex: 1;
                height: 44px;
                font-size: 14px;
            }
            
            .modify-btn {
                width: 80%;
                height: 44px;
                font-size: 16px;
                margin: 0 auto;
            }
        }
        
        @media (max-width: 480px) {
            body {
                padding: 16px 12px;
            }
            
            .language-selector {
                position: static !important;
                justify-content: center !important;
                margin-bottom: 16px !important;
            }
            
            .title {
                font-size: 20px;
                margin-bottom: 16px;
            }
            
            .module-counter {
                font-size: 14px !important;
                margin-bottom: 12px !important;
            }
            
            .option-summary {
                margin-bottom: 20px !important;
                padding: 12px !important;
            }
            
            .option-summary div:first-child {
                font-size: 12px !important;
                margin-bottom: 8px !important;
            }
            
            .card {
                padding: 12px;
            }
            
            .center-square {
                width: 60px;
                height: 60px;
            }
            
            .text-line {
                height: 28px;
                font-size: 11px;
                padding: 0 22px 0 6px;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }
            
            .button {
                flex: 1;
                height: 40px;
                font-size: 12px;
            }
            
            .modify-btn {
                width: 100%;
                height: 40px;
                font-size: 14px;
                margin: 0 auto;
            }
            
            .language-selector {
                position: static !important;
                justify-content: center !important;
                margin-bottom: 20px !important;
            }
        }
        
        /* 언어 선택기 스타일 */
        .language-selector {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 8px;
            z-index: 1000;
        }
        
        .language-flag {
            width: 40px;
            height: 30px;
            cursor: pointer;
            border-radius: 4px;
            border: 2px solid transparent;
            transition: all 0.2s ease;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .language-flag img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .language-flag:hover {
            border-color: #007bff;
            transform: scale(1.1);
        }

        .language-flag.active {
            border-color: #007bff;
            box-shadow: 0 0 8px rgba(0, 123, 255, 0.3);
        }

        /* Select 옵션 스타일 */
        .tier-select option {
            background-color: white;
            color: black;
        }

        .tier-select option[data-tier="12"],
        .tier-select option[data-tier="13"],
        .tier-select option[data-tier="14"] {
            color: rgb(17, 167, 238);
            font-weight: 600;
        }

        .tier-select option[data-tier="15"] {
            background-color: black;
            color: rgb(17, 167, 238);
            font-weight: 600;
        }

        [data-theme="dark"] .tier-select option {
            background-color: #2d2d2d;
            color: #e0e0e0;
        }

        [data-theme="dark"] .tier-select option[data-tier="12"],
        [data-theme="dark"] .tier-select option[data-tier="13"],
        [data-theme="dark"] .tier-select option[data-tier="14"] {
            color: rgb(17, 167, 238);
        }

        [data-theme="dark"] .tier-select option[data-tier="15"] {
            background-color: black;
            color: rgb(17, 167, 238);
        }

        /* 다크모드 토글 스타일 */
        .theme-toggle {
            position: absolute;
            top: 20px;
            left: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 8px 12px;
            background-color: var(--bg-card);
            border: 2px solid var(--border-color);
            border-radius: 20px;
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .theme-toggle:hover {
            border-color: #007bff;
            transform: scale(1.05);
        }

        .theme-icon {
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* 모바일 헤더 컨테이너 */
        .mobile-header {
            display: none;
        }

        @media (max-width: 768px) {
            .theme-toggle {
                position: static;
                padding: 10px 14px;
            }

            .language-selector {
                position: static !important;
                justify-content: center !important;
                margin: 0 !important;
            }

            .mobile-header {
                display: flex;
                justify-content: center;
                align-items: center;
                gap: 12px;
                margin-bottom: 16px;
                flex-wrap: wrap;
            }

            /* 데스크탑에서 표시되는 요소 숨김 */
            .container > .theme-toggle,
            .container > .language-selector {
                display: none !important;
            }
        }

        @media (max-width: 480px) {
            .theme-toggle {
                padding: 8px 10px;
            }

            .theme-icon {
                font-size: 16px;
            }

            .language-flag {
                width: 36px;
                height: 27px;
            }

            .mobile-header {
                gap: 10px;
                margin-bottom: 12px;
            }
        }

        /* 컨텐츠 섹션 스타일 */
        .content-section {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 32px;
            margin-top: 60px;
            border: 1px solid var(--border-color);
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }

        .content-section h2 {
            font-size: 28px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 24px;
            text-align: center;
            transition: color 0.3s ease;
        }

        .content-section h3 {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-primary);
            margin-top: 24px;
            margin-bottom: 16px;
            transition: color 0.3s ease;
        }

        .content-section p,
        .content-section li {
            font-size: 16px;
            line-height: 1.8;
            color: var(--text-secondary);
            margin-bottom: 12px;
            transition: color 0.3s ease;
        }

        .content-section ul {
            padding-left: 24px;
            margin-bottom: 16px;
        }

        .content-section li {
            margin-bottom: 8px;
        }

        .effect-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: var(--bg-secondary);
            border-radius: 8px;
            overflow: hidden;
        }

        .effect-table th,
        .effect-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-secondary);
            transition: color 0.3s ease, border-color 0.3s ease;
        }

        .effect-table th {
            background: var(--summary-bg);
            font-weight: 600;
            color: var(--text-primary);
        }

        .effect-table tr:last-child td {
            border-bottom: none;
        }

        .faq-item {
            margin-bottom: 24px;
            padding: 20px;
            background: var(--summary-bg);
            border-radius: 8px;
            transition: background-color 0.3s ease;
        }

        .faq-item strong {
            color: var(--text-primary);
            font-size: 18px;
            display: block;
            margin-bottom: 12px;
            transition: color 0.3s ease;
        }

        @media (max-width: 768px) {
            .content-section {
                padding: 24px;
                margin-top: 40px;
            }

            .content-section h2 {
                font-size: 22px;
                margin-bottom: 20px;
            }

            .content-section h3 {
                font-size: 18px;
                margin-top: 20px;
                margin-bottom: 12px;
            }

            .content-section p,
            .content-section li {
                font-size: 14px;
            }

            .effect-table {
                font-size: 14px;
            }

            .effect-table th,
            .effect-table td {
                padding: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 다크모드 토글 -->
        <div class="theme-toggle" id="themeToggle">
            <span class="theme-icon">🌙</span>
        </div>

        <!-- 언어 선택기 -->
        <div class="language-selector">
            <div class="language-flag active" data-lang="ko" title="한국어">
                <img src="https://flagcdn.com/w80/kr.png" alt="한국어">
            </div>
            <div class="language-flag" data-lang="ja" title="日本語">
                <img src="https://flagcdn.com/w80/jp.png" alt="日本語">
            </div>
            <div class="language-flag" data-lang="zh" title="繁體中文">
                <img src="https://flagcdn.com/w80/tw.png" alt="繁體中文">
            </div>
            <div class="language-flag" data-lang="en" title="English">
                <img src="https://flagcdn.com/w80/us.png" alt="English">
            </div>
        </div>

        <!-- 모바일 헤더 (768px 이하에서만 표시) -->
        <div class="mobile-header">
            <div class="theme-toggle" id="themeToggleMobile">
                <span class="theme-icon">🌙</span>
            </div>
            <div class="language-selector">
                <div class="language-flag active" data-lang="ko" title="한국어">
                    <img src="https://flagcdn.com/w80/kr.png" alt="한국어">
                </div>
                <div class="language-flag" data-lang="ja" title="日本語">
                    <img src="https://flagcdn.com/w80/jp.png" alt="日本語">
                </div>
                <div class="language-flag" data-lang="zh" title="繁體中文">
                    <img src="https://flagcdn.com/w80/tw.png" alt="繁體中文">
                </div>
                <div class="language-flag" data-lang="en" title="English">
                    <img src="https://flagcdn.com/w80/us.png" alt="English">
                </div>
            </div>
        </div>

        <div class="title">니케 모듈작 시뮬레이션</div>
        
        <div class="grid-container">
            <!-- Card 1 -->
            <div class="card">
                <div class="card-content">
                    <div class="center-square image1" style="background-image: url('images/weapon-head.webp');">
                    </div>
                    <div class="text-lines">
                        <div class="text-line">효과 미획득</div>
                        <div class="text-line">효과 미획득</div>
                        <div class="text-line">효과 미획득</div>
                    </div>
                </div>
                <div class="modify-container">
                    <button class="modify-btn">장비 개조</button>
                </div>
                <div class="button-container">
                    <button class="button effect-btn">효과 변경</button>
                    <button class="button reset-btn">수치 재설정</button>
                </div>
            </div>

            <!-- Card 2 -->
            <div class="card">
                <div class="card-content">
                    <div class="center-square image2" style="background-image: url('images/weapon-body.webp');">
                    </div>
                    <div class="text-lines">
                        <div class="text-line">효과 미획득</div>
                        <div class="text-line">효과 미획득</div>
                        <div class="text-line">효과 미획득</div>
                    </div>
                </div>
                <div class="modify-container">
                    <button class="modify-btn">장비 개조</button>
                </div>
                <div class="button-container">
                    <button class="button effect-btn">효과 변경</button>
                    <button class="button reset-btn">수치 재설정</button>
                </div>
            </div>

            <!-- Card 3 -->
            <div class="card">
                <div class="card-content">
                    <div class="center-square image3" style="background-image: url('images/weapon-hand.webp');">
                    </div>
                    <div class="text-lines">
                        <div class="text-line">효과 미획득</div>
                        <div class="text-line">효과 미획득</div>
                        <div class="text-line">효과 미획득</div>
                    </div>
                </div>
                <div class="modify-container">
                    <button class="modify-btn">장비 개조</button>
                </div>
                <div class="button-container">
                    <button class="button effect-btn">효과 변경</button>
                    <button class="button reset-btn">수치 재설정</button>
                </div>
            </div>

            <!-- Card 4 -->
            <div class="card">
                <div class="card-content">
                    <div class="center-square image4" style="background-image: url('images/weapon-foot.webp');">
                    </div>
                    <div class="text-lines">
                        <div class="text-line">효과 미획득</div>
                        <div class="text-line">효과 미획득</div>
                        <div class="text-line">효과 미획득</div>
                    </div>
                </div>
                <div class="modify-container">
                    <button class="modify-btn">장비 개조</button>
                </div>
                <div class="button-container">
                    <button class="button effect-btn">효과 변경</button>
                    <button class="button reset-btn">수치 재설정</button>
                </div>
            </div>
        </div>
        
        <div style="text-align: center; margin: 40px 0 20px 0;">
            <div style="display: flex; justify-content: center; align-items: center; gap: 16px; margin-bottom: 12px; flex-wrap: wrap;">
                <button id="customModeBtn" style="background-color: #28a745; color: white; border: none; border-radius: 6px; padding: 8px 16px; font-size: 14px; font-weight: 500; cursor: pointer; transition: background-color 0.2s ease;">
                    커스텀
                </button>
                <button id="resetAllBtn" style="background-color: #dc3545; color: white; border: none; border-radius: 6px; padding: 8px 16px; font-size: 14px; font-weight: 500; cursor: pointer; transition: background-color 0.2s ease;">
                    초기화
                </button>
                <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; font-size: 14px; color: var(--text-primary); transition: color 0.3s ease;">
                    <input type="checkbox" id="protectHighTier" checked style="cursor: pointer; width: 16px; height: 16px;">
                    <span id="protectLabel">상위 티어 옵션 보호</span>
                </label>
            </div>
            <div class="module-counter" style="font-size: 18px; font-weight: 500; color: var(--text-primary); transition: color 0.3s ease;">
                사용된 모듈 개수: <span id="moduleCount">0</span>
            </div>
        </div>
        <div class="option-summary" style="background: var(--summary-bg); border-radius: 8px; padding: 20px; margin-bottom: 40px; transition: background-color 0.3s ease;">
            <div style="text-align: center; font-size: 16px; font-weight: 600; color: var(--text-primary); margin-bottom: 16px; transition: color 0.3s ease;">
                현재 옵션 총합
            </div>
            <div id="optionSummary" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px; font-size: 14px;">
                <!-- 옵션 총합이 여기에 표시됩니다 -->
            </div>
        </div>

        <!-- 사용 가이드 섹션 -->
        <div class="content-section" id="guideSection">
            <h2 id="guideSectionTitle">사용 가이드</h2>
            <p id="guideIntroText">이 시뮬레이터는 니케(NIKKE)의 오버로드 모듈 시스템을 재현하여 장비 개조 및 옵션 조합을 테스트할 수 있도록 도와줍니다.</p>

            <h3 id="guideBasicSectionTitle">기본 사용법</h3>
            <ul>
                <li id="guideBasic1Text">장비 개조: 각 장비 슬롯(머리, 몸통, 손, 발)의 "장비 개조" 버튼을 클릭하여 초기 옵션을 생성합니다. 모듈 1개가 소모됩니다.</li>
                <li id="guideBasic2Text">효과 변경: 획득한 옵션의 "효과 변경" 버튼을 클릭하여 효과 종류를 재설정합니다. 잠긴 슬롯이 있을 경우 추가 모듈이 소모됩니다.</li>
                <li id="guideBasic3Text">수치 재설정: "수치 재설정" 버튼으로 효과는 유지하되 티어(수치)만 재설정합니다.</li>
                <li id="guideBasic4Text">옵션 잠금: 각 효과 옆의 자물쇠 아이콘을 클릭하여 원하는 옵션을 고정할 수 있습니다. 잠금 시 모듈이 소모됩니다 (첫 번째: 2개, 두 번째: 3개, 세 번째: 4개).</li>
            </ul>

            <h3 id="guideCustomSectionTitle">커스텀 모드</h3>
            <ul>
                <li id="guideCustom1Text">"커스텀 모드 시작" 버튼을 클릭하면 수동으로 효과와 티어를 선택할 수 있습니다.</li>
                <li id="guideCustom2Text">효과 드롭다운에서 원하는 효과를, 수치 드롭다운에서 원하는 티어를 선택하세요.</li>
                <li id="guideCustom3Text">커스텀 모드에서는 모듈이 소모되지 않으며, 다양한 옵션 조합을 자유롭게 테스트할 수 있습니다.</li>
                <li id="guideCustom4Text">같은 장비 내에서 중복된 효과는 선택할 수 없습니다.</li>
            </ul>

            <h3 id="guideFeaturesSectionTitle">주요 기능</h3>
            <ul>
                <li id="guideFeatures1Text">상위 티어 옵션 보호: 12-15티어 옵션이 있을 때 효과 변경/수치 재설정 시 확인 메시지를 표시합니다.</li>
                <li id="guideFeatures2Text">다크 모드: 좌측 상단의 달/해 아이콘으로 테마를 전환할 수 있습니다.</li>
                <li id="guideFeatures3Text">다국어 지원: 한국어, 일본어, 번체 중국어, 영어를 지원합니다.</li>
                <li id="guideFeatures4Text">옵션 총합: 모든 장비의 효과가 자동으로 합산되어 표시됩니다.</li>
            </ul>
        </div>

        <!-- 모듈 효과 정보 섹션 -->
        <div class="content-section" id="effectInfoSection">
            <h2 id="effectInfoSectionTitle">모듈 효과 정보</h2>
            <p id="effectInfoIntroText">오버로드 모듈에서 획득할 수 있는 9가지 효과 종류와 티어별 수치 범위입니다.</p>

            <table class="effect-table">
                <thead>
                    <tr>
                        <th id="effectTableNameHeader">효과 이름</th>
                        <th id="effectTableProbHeader">출현 확률</th>
                        <th id="effectTableRangeHeader">수치 범위 (1-15티어)</th>
                    </tr>
                </thead>
                <tbody id="effectTableBody">
                    <!-- 효과 정보가 동적으로 여기에 표시됩니다 -->
                </tbody>
            </table>
        </div>

        <!-- FAQ 섹션 -->
        <div class="content-section" id="faqSection">
            <h2 id="faqSectionTitle">자주 묻는 질문</h2>

            <div class="faq-item">
                <strong id="faq1QText">Q. 모듈 개수는 어떻게 계산되나요?</strong>
                <p id="faq1AText">A. 장비 개조 시 1개, 효과 변경/수치 재설정 시 1개가 소모됩니다. 옵션을 잠글 경우 첫 번째 잠금 시 2개, 두 번째 3개, 세 번째 4개가 추가로 소모됩니다. 잠금이 있는 상태에서 효과 변경/수치 재설정 시 추가 비용(잠금 1개: +1, 잠금 2개: +2)이 발생합니다.</p>
            </div>

            <div class="faq-item">
                <strong id="faq2QText">Q. 티어별 획득 확률은 어떻게 되나요?</strong>
                <p id="faq2AText">A. 1-5티어는 각각 12% 확률, 6-10티어는 각각 7% 확률, 11-15티어는 각각 1% 확률로 설정되어 있습니다.</p>
            </div>

            <div class="faq-item">
                <strong id="faq3QText">Q. 슬롯별 효과 획득 확률은요?</strong>
                <p id="faq3AText">A. 첫 번째 슬롯은 100%, 두 번째 슬롯은 50%, 세 번째 슬롯은 30% 확률로 효과가 생성됩니다.</p>
            </div>

            <div class="faq-item">
                <strong id="faq4QText">Q. 커스텀 모드와 일반 모드의 차이는 무엇인가요?</strong>
                <p id="faq4AText">A. 일반 모드는 실제 게임처럼 확률에 따라 랜덤으로 효과와 티어가 결정되며 모듈이 소모됩니다. 커스텀 모드는 모든 효과와 티어를 자유롭게 선택할 수 있으며 모듈이 소모되지 않아 다양한 조합을 테스트하기에 적합합니다.</p>
            </div>

            <div class="faq-item">
                <strong id="faq5QText">Q. 같은 장비에 중복된 효과를 가질 수 있나요?</strong>
                <p id="faq5AText">A. 아니요, 같은 장비 내에서는 서로 다른 효과만 선택할 수 있습니다. 다만 서로 다른 장비 간에는 같은 효과를 가질 수 있으며, 이 경우 옵션 총합에 합산되어 표시됩니다.</p>
            </div>
        </div>
    </div>

    <script>
        // 언어 데이터
        const translations = {
            ko: {
                title: '니케 모듈작 시뮬레이션',
                equipmentModification: '장비 개조',
                effectChange: '효과 변경',
                valueReset: '수치 재설정',
                reset: '초기화',
                moduleCount: '사용된 모듈 개수',
                optionTotal: '현재 옵션 총합',
                effectNotObtained: '효과 미획득',
                noActiveOptions: '활성화된 옵션이 없습니다',
                confirmHighTier: '현재 잠겨져 있지 않은 옵션 중 상위 티어 옵션이 존재합니다. 실행하시겠습니까?',
                protectHighTier: '상위 티어 옵션 보호',
                customModeOn: '커스텀 모드 시작',
                customModeOff: '커스텀 모드 종료',
                selectEffect: '효과',
                selectValue: '수치',
                effects: {
                    '우월코드 대미지 증가': '[우월코드 대미지 증가]',
                    '명중률 증가': '[명중률 증가]',
                    '최대 장탄 수 증가': '[최대 장탄 수 증가]',
                    '공격력 증가': '[공격력 증가]',
                    '차지 대미지 증가': '[차지 대미지 증가]',
                    '차지 속도 증가': '[차지 속도 증가]',
                    '크리티컬 확률 증가': '[크리티컬 확률 증가]',
                    '방어력 증가': '[방어력 증가]',
                    '크리티컬 대미지 증가': '[크리티컬 대미지 증가]'
                },
                guideTitle: '사용 가이드',
                guideIntro: '이 시뮬레이터는 니케(NIKKE)의 오버로드 모듈 시스템을 재현하여 장비 개조 및 옵션 조합을 테스트할 수 있도록 도와줍니다.',
                guideBasicTitle: '기본 사용법',
                guideBasic1: '장비 개조: 각 장비 슬롯(머리, 몸통, 손, 발)의 "장비 개조" 버튼을 클릭하여 초기 옵션을 생성합니다. 모듈 1개가 소모됩니다.',
                guideBasic2: '효과 변경: 획득한 옵션의 "효과 변경" 버튼을 클릭하여 효과 종류를 재설정합니다. 잠긴 슬롯이 있을 경우 추가 모듈이 소모됩니다.',
                guideBasic3: '수치 재설정: "수치 재설정" 버튼으로 효과는 유지하되 티어(수치)만 재설정합니다.',
                guideBasic4: '옵션 잠금: 각 효과 옆의 자물쇠 아이콘을 클릭하여 원하는 옵션을 고정할 수 있습니다. 잠금 시 모듈이 소모됩니다 (첫 번째: 2개, 두 번째: 3개, 세 번째: 4개).',
                guideCustomTitle: '커스텀 모드',
                guideCustom1: '"커스텀 모드 시작" 버튼을 클릭하면 수동으로 효과와 티어를 선택할 수 있습니다.',
                guideCustom2: '효과 드롭다운에서 원하는 효과를, 수치 드롭다운에서 원하는 티어를 선택하세요.',
                guideCustom3: '커스텀 모드에서는 모듈이 소모되지 않으며, 다양한 옵션 조합을 자유롭게 테스트할 수 있습니다.',
                guideCustom4: '같은 장비 내에서 중복된 효과는 선택할 수 없습니다.',
                guideFeaturesTitle: '주요 기능',
                guideFeatures1: '상위 티어 옵션 보호: 12-15티어 옵션이 있을 때 효과 변경/수치 재설정 시 확인 메시지를 표시합니다.',
                guideFeatures2: '다크 모드: 좌측 상단의 달/해 아이콘으로 테마를 전환할 수 있습니다.',
                guideFeatures3: '다국어 지원: 한국어, 일본어, 번체 중국어, 영어를 지원합니다.',
                guideFeatures4: '옵션 총합: 모든 장비의 효과가 자동으로 합산되어 표시됩니다.',
                effectInfoTitle: '모듈 효과 정보',
                effectInfoIntro: '오버로드 모듈에서 획득할 수 있는 9가지 효과 종류와 티어별 수치 범위입니다.',
                effectTableName: '효과 이름',
                effectTableProb: '출현 확률',
                effectTableRange: '수치 범위 (1-15티어)',
                faqTitle: '자주 묻는 질문',
                faq1Q: 'Q. 모듈 개수는 어떻게 계산되나요?',
                faq1A: 'A. 장비 개조 시 1개, 효과 변경/수치 재설정 시 1개가 소모됩니다. 옵션을 잠글 경우 첫 번째 잠금 시 2개, 두 번째 3개, 세 번째 4개가 추가로 소모됩니다. 잠금이 있는 상태에서 효과 변경/수치 재설정 시 추가 비용(잠금 1개: +1, 잠금 2개: +2)이 발생합니다.',
                faq2Q: 'Q. 티어별 획득 확률은 어떻게 되나요?',
                faq2A: 'A. 1-5티어는 각각 12% 확률, 6-10티어는 각각 7% 확률, 11-15티어는 각각 1% 확률로 설정되어 있습니다.',
                faq3Q: 'Q. 슬롯별 효과 획득 확률은요?',
                faq3A: 'A. 첫 번째 슬롯은 100%, 두 번째 슬롯은 50%, 세 번째 슬롯은 30% 확률로 효과가 생성됩니다.',
                faq4Q: 'Q. 커스텀 모드와 일반 모드의 차이는 무엇인가요?',
                faq4A: 'A. 일반 모드는 실제 게임처럼 확률에 따라 랜덤으로 효과와 티어가 결정되며 모듈이 소모됩니다. 커스텀 모드는 모든 효과와 티어를 자유롭게 선택할 수 있으며 모듈이 소모되지 않아 다양한 조합을 테스트하기에 적합합니다.',
                faq5Q: 'Q. 같은 장비에 중복된 효과를 가질 수 있나요?',
                faq5A: 'A. 아니요, 같은 장비 내에서는 서로 다른 효과만 선택할 수 있습니다. 다만 서로 다른 장비 간에는 같은 효과를 가질 수 있으며, 이 경우 옵션 총합에 합산되어 표시됩니다.'
            },
            ja: {
                title: 'NIKKE オバロ シミュレーション',
                equipmentModification: '装備の改造',
                effectChange: '効果変更',
                valueReset: '数値再設定',
                reset: 'リセット',
                moduleCount: 'カスタムモジュール',
                optionTotal: '総合',
                effectNotObtained: '効果未取得',
                noActiveOptions: 'アクティブなオプションがありません',
                confirmHighTier: 'ロックされていないオプションの中に上位ティアオプションが存在します。実行しますか？',
                protectHighTier: '上位ティアオプション保護',
                customModeOn: 'カスタムモード開始',
                customModeOff: 'カスタムモード終了',
                selectEffect: '効果',
                selectValue: '数値',
                effects: {
                    '우월코드 대미지 증가': '「有利コードダメージ増加」',
                    '명중률 증가': '「命中率増加」',
                    '최대 장탄 수 증가': '「最大装弾数増加」',
                    '공격력 증가': '「攻撃力増加」',
                    '차지 대미지 증가': '「チャージダメージ増加」',
                    '차지 속도 증가': '「チャージ速度増加」',
                    '크리티컬 확률 증가': '「クリティカル確률増加」',
                    '방어력 증가': '「防御力増加」',
                    '크리티컬 대미지 증가': '「クリティカルダメージ増加」'
                },
                guideTitle: '使用ガイド',
                guideIntro: 'このシミュレーターはNIKKEのオーバーロードモジュールシステムを再現し、装備改造とオプション組み合わせをテストできます。',
                guideBasicTitle: '基本的な使い方',
                guideBasic1: '装備の改造: 各装備スロット(頭、胴体、手、足)の「装備の改造」ボタンをクリックして初期オプションを生成します。モジュール1個を消費します。',
                guideBasic2: '効果変更: 獲得したオプションの「効果変更」ボタンをクリックして効果の種類を再設定します。ロックされたスロットがある場合、追加のモジュールを消費します。',
                guideBasic3: '数値再設定: 「数値再設定」ボタンで効果は維持しつつティア(数値)のみを再設定します。',
                guideBasic4: 'オプションロック: 各効果の横にある鍵アイコンをクリックして希望するオプションを固定できます。ロック時にモジュールを消費します(1番目: 2個、2番目: 3個、3番目: 4個)。',
                guideCustomTitle: 'カスタムモード',
                guideCustom1: '「カスタムモード開始」ボタンをクリックすると、手動で効果とティアを選択できます。',
                guideCustom2: '効果ドロップダウンから希望する効果を、数値ドロップダウンから希望するティアを選択してください。',
                guideCustom3: 'カスタムモードではモジュールを消費せず、様々なオプションの組み合わせを自由にテストできます。',
                guideCustom4: '同じ装備内で重複した効果は選択できません。',
                guideFeaturesTitle: '主な機能',
                guideFeatures1: '上位ティアオプション保護: 12-15ティアオプションがある場合、効果変更/数値再設定時に確認メッセージが表示されます。',
                guideFeatures2: 'ダークモード: 左上の月/太陽アイコンでテーマを切り替えられます。',
                guideFeatures3: '多言語対応: 韓国語、日本語、繁体字中国語、英語に対応しています。',
                guideFeatures4: 'オプション合計: すべての装備の効果が自動的に合算されて表示されます。',
                effectInfoTitle: 'モジュール効果情報',
                effectInfoIntro: 'オーバーロードモジュールで獲得できる9種類の効果とティア別数値範囲です。',
                effectTableName: '効果名',
                effectTableProb: '出現確率',
                effectTableRange: '数値範囲 (1-15ティア)',
                faqTitle: 'よくある質問',
                faq1Q: 'Q. モジュール数はどのように計算されますか?',
                faq1A: 'A. 装備改造時に1個、効果変更/数値再設定時に1個消費されます。オプションをロックする場合、1番目のロック時に2個、2番目に3個、3番目に4個が追加で消費されます。ロックがある状態で効果変更/数値再設定する場合、追加コスト(ロック1個: +1、ロック2個: +2)が発生します。',
                faq2Q: 'Q. ティア別獲得確率はどうなっていますか?',
                faq2A: 'A. 1-5ティアはそれぞれ12%の確率、6-10ティアはそれぞれ7%の確率、11-15ティアはそれぞれ1%の確率で設定されています。',
                faq3Q: 'Q. スロット別効果獲得確率は?',
                faq3A: 'A. 1番目のスロットは100%、2番目のスロットは50%、3番目のスロットは30%の確率で効果が生成されます。',
                faq4Q: 'Q. カスタムモードと通常モードの違いは何ですか?',
                faq4A: 'A. 通常モードは実際のゲームのように確率に応じてランダムに効果とティアが決定され、モジュールを消費します。カスタムモードはすべての効果とティアを自由に選択でき、モジュールを消費しないため様々な組み合わせのテストに適しています。',
                faq5Q: 'Q. 同じ装備に重複した効果を持てますか?',
                faq5A: 'A. いいえ、同じ装備内では異なる効果のみ選択できます。ただし、異なる装備間では同じ効果を持つことができ、この場合オプション合計に合算されて表示されます。'
            },
            zh: {
                title: 'NIKKE 模組作業模擬',
                equipmentModification: '裝備改造',
                effectChange: '效果變更',
                valueReset: '重新設定數值',
                reset: '初始化',
                moduleCount: '使用的模組數量',
                optionTotal: '當前選項總和',
                effectNotObtained: '未獲得效果',
                noActiveOptions: '沒有啟用的選項',
                confirmHighTier: '目前未鎖定的選項中存在高階選項。是否要執行？',
                protectHighTier: '高階選項保護',
                customModeOn: '自訂模式開始',
                customModeOff: '自訂模式結束',
                selectEffect: '效果',
                selectValue: '數值',
                effects: {
                    '우월코드 대미지 증가': '【優越代碼傷害增加】',
                    '명중률 증가': '【命中率增加】',
                    '최대 장탄 수 증가': '【最大裝彈數增加】',
                    '공격력 증가': '【攻擊力增加】',
                    '차지 대미지 증가': '【蓄力傷害增加】',
                    '차지 속도 증가': '【蓄力速度增加】',
                    '크리티컬 확률 증가': '【暴擊率增加】',
                    '방어력 증가': '【防禦力增加】',
                    '크리티컬 대미지 증가': '【暴擊傷害增加】'
                },
                guideTitle: '使用指南',
                guideIntro: '此模擬器重現了NIKKE的Over Load模組系統，可協助您測試裝備改造和選項組合。',
                guideBasicTitle: '基本使用方法',
                guideBasic1: '裝備改造: 點擊各裝備槽位(頭、身體、手、腳)的「裝備改造」按鈕生成初始選項。消耗1個模組。',
                guideBasic2: '效果變更: 點擊已獲得選項的「效果變更」按鈕重新設定效果種類。若有鎖定槽位，將消耗額外模組。',
                guideBasic3: '重新設定數值: 使用「重新設定數值」按鈕維持效果，僅重新設定階級(數值)。',
                guideBasic4: '選項鎖定: 點擊各效果旁的鎖圖示可固定想要的選項。鎖定時消耗模組(第1個: 2個，第2個: 3個，第3個: 4個)。',
                guideCustomTitle: '自訂模式',
                guideCustom1: '點擊「自訂模式開始」按鈕可手動選擇效果和階級。',
                guideCustom2: '從效果下拉選單選擇想要的效果，從數值下拉選單選擇想要的階級。',
                guideCustom3: '在自訂模式中不會消耗模組，可自由測試各種選項組合。',
                guideCustom4: '同一裝備內無法選擇重複的效果。',
                guideFeaturesTitle: '主要功能',
                guideFeatures1: '高階選項保護: 當有12-15階級選項時，效果變更/數值重設時會顯示確認訊息。',
                guideFeatures2: '深色模式: 可透過左上角的月亮/太陽圖示切換主題。',
                guideFeatures3: '多語言支援: 支援韓語、日語、繁體中文、英語。',
                guideFeatures4: '選項總和: 所有裝備的效果會自動加總顯示。',
                effectInfoTitle: '模組效果資訊',
                effectInfoIntro: 'Over Load模組可獲得的9種效果類型及各階級數值範圍。',
                effectTableName: '效果名稱',
                effectTableProb: '出現機率',
                effectTableRange: '數值範圍 (1-15階級)',
                faqTitle: '常見問題',
                faq1Q: 'Q. 模組數量如何計算?',
                faq1A: 'A. 裝備改造時消耗1個，效果變更/數值重設時消耗1個。鎖定選項時，第1個鎖定消耗2個，第2個3個，第3個4個。有鎖定的狀態下進行效果變更/數值重設時會產生額外費用(鎖定1個: +1，鎖定2個: +2)。',
                faq2Q: 'Q. 各階級的獲得機率如何?',
                faq2A: 'A. 1-5階級各為12%機率，6-10階級各為7%機率，11-15階級各為1%機率。',
                faq3Q: 'Q. 各槽位的效果獲得機率呢?',
                faq3A: 'A. 第1個槽位為100%，第2個槽位為50%，第3個槽位為30%的機率生成效果。',
                faq4Q: 'Q. 自訂模式和一般模式有什麼差異?',
                faq4A: 'A. 一般模式如同實際遊戲，根據機率隨機決定效果和階級並消耗模組。自訂模式可自由選擇所有效果和階級且不消耗模組，適合測試各種組合。',
                faq5Q: 'Q. 同一裝備可以有重複的效果嗎?',
                faq5A: 'A. 不行，同一裝備內只能選擇不同的效果。但不同裝備間可以有相同效果，此時會在選項總和中加總顯示。'
            },
            en: {
                title: 'NIKKE Over Load Simulation',
                equipmentModification: 'Equipment Modification',
                effectChange: 'Change Effects',
                valueReset: 'Reset Attributes',
                reset: 'Reset',
                moduleCount: 'Modules Used',
                optionTotal: 'Total Options',
                effectNotObtained: 'Effect Not Obtained',
                noActiveOptions: 'No active options',
                confirmHighTier: 'There are high-tier options among the unlocked options. Do you want to proceed?',
                protectHighTier: 'Protect High-Tier Options',
                customModeOn: 'Start Custom Mode',
                customModeOff: 'End Custom Mode',
                selectEffect: 'Effect',
                selectValue: 'Attributes',
                effects: {
                    '우월코드 대미지 증가': 'Increase Element Damage Dealt',
                    '명중률 증가': 'Increase Hit Rate',
                    '최대 장탄 수 증가': 'Increase Max Ammunition Capacity',
                    '공격력 증가': 'Increase ATK',
                    '차지 대미지 증가': 'Increase Charge Damage',
                    '차지 속도 증가': 'Increase Charge Speed',
                    '크리티컬 확률 증가': 'Increase Critical Rate',
                    '방어력 증가': 'Increase DEF',
                    '크리티컬 대미지 증가': 'Increase Critical Damage'
                },
                guideTitle: 'User Guide',
                guideIntro: 'This simulator replicates NIKKE\'s Over Load module system, helping you test equipment modifications and option combinations.',
                guideBasicTitle: 'Basic Usage',
                guideBasic1: 'Equipment Modification: Click the "Equipment Modification" button for each equipment slot (Head, Body, Hands, Feet) to generate initial options. Consumes 1 module.',
                guideBasic2: 'Change Effects: Click the "Change Effects" button on acquired options to reset the effect type. Additional modules are consumed if there are locked slots.',
                guideBasic3: 'Reset Attributes: Use the "Reset Attributes" button to maintain the effect while resetting only the tier (value).',
                guideBasic4: 'Option Locking: Click the lock icon next to each effect to fix desired options. Modules are consumed when locking (1st: 2, 2nd: 3, 3rd: 4).',
                guideCustomTitle: 'Custom Mode',
                guideCustom1: 'Click the "Start Custom Mode" button to manually select effects and tiers.',
                guideCustom2: 'Select the desired effect from the effect dropdown and the desired tier from the value dropdown.',
                guideCustom3: 'In custom mode, modules are not consumed, allowing you to freely test various option combinations.',
                guideCustom4: 'Duplicate effects cannot be selected within the same equipment.',
                guideFeaturesTitle: 'Key Features',
                guideFeatures1: 'High-Tier Option Protection: Displays a confirmation message when changing effects/resetting values if 12-15 tier options exist.',
                guideFeatures2: 'Dark Mode: Switch themes using the moon/sun icon in the top left corner.',
                guideFeatures3: 'Multi-language Support: Supports Korean, Japanese, Traditional Chinese, and English.',
                guideFeatures4: 'Option Totals: Effects from all equipment are automatically summed and displayed.',
                effectInfoTitle: 'Module Effect Information',
                effectInfoIntro: '9 types of effects available in Over Load modules and their tier-based value ranges.',
                effectTableName: 'Effect Name',
                effectTableProb: 'Drop Rate',
                effectTableRange: 'Value Range (Tier 1-15)',
                faqTitle: 'Frequently Asked Questions',
                faq1Q: 'Q. How are module counts calculated?',
                faq1A: 'A. 1 module is consumed for equipment modification, 1 for effect change/attribute reset. When locking options, 2 modules for the 1st lock, 3 for the 2nd, 4 for the 3rd are additionally consumed. Additional costs occur when changing effects/resetting attributes with locks present (1 lock: +1, 2 locks: +2).',
                faq2Q: 'Q. What are the acquisition rates by tier?',
                faq2A: 'A. Tiers 1-5 each have a 12% rate, tiers 6-10 each have a 7% rate, and tiers 11-15 each have a 1% rate.',
                faq3Q: 'Q. What about effect acquisition rates by slot?',
                faq3A: 'A. The 1st slot has a 100% rate, the 2nd slot has a 50% rate, and the 3rd slot has a 30% rate for effect generation.',
                faq4Q: 'Q. What\'s the difference between custom mode and normal mode?',
                faq4A: 'A. Normal mode randomly determines effects and tiers based on probability like the actual game and consumes modules. Custom mode allows free selection of all effects and tiers without consuming modules, making it suitable for testing various combinations.',
                faq5Q: 'Q. Can the same equipment have duplicate effects?',
                faq5A: 'A. No, only different effects can be selected within the same equipment. However, different equipment can have the same effects, which will be summed and displayed in the option totals.'
            }
        };
        
        // 현재 언어 설정
        let currentLanguage = 'ko';

        // 커스텀 모드 상태 (false = 일반 모드, true = 커스텀 모드)
        let isCustomMode = false;
        
        // 언어 변경 함수
        function changeLanguage(lang) {
            currentLanguage = lang;
            localStorage.setItem('nikkeLanguage', lang);
            updateAllTexts();
            updateLanguageFlags();

            // 커스텀 모드일 때 언어 변경 시 Select 박스 재렌더링
            if (isCustomMode) {
                for (let i = 0; i < 4; i++) {
                    updateEffectDisplay(i);
                }
                attachSelectChangeListeners();
            }
        }
        
        // 모든 텍스트 업데이트 함수
        function updateAllTexts() {
            const t = translations[currentLanguage];

            // 페이지 제목 (브라우저 탭)
            document.title = t.title + ' | NIKKE Over Load Module Simulator';

            // 제목
            document.querySelector('.title').textContent = t.title;
            
            // 버튼들
            document.querySelectorAll('.modify-btn').forEach(btn => {
                btn.textContent = t.equipmentModification;
            });
            
            document.querySelectorAll('.effect-btn').forEach(btn => {
                btn.textContent = t.effectChange;
            });
            
            document.querySelectorAll('.reset-btn').forEach(btn => {
                btn.textContent = t.valueReset;
            });
            
            document.getElementById('resetAllBtn').textContent = t.reset;

            // 커스텀 모드 버튼
            const customBtn = document.getElementById('customModeBtn');
            if (customBtn) {
                customBtn.textContent = isCustomMode ? t.customModeOff : t.customModeOn;
            }

            // 상위 티어 보호 라벨
            document.getElementById('protectLabel').textContent = t.protectHighTier;

            // 모듈 카운터
            const moduleCountElement = document.getElementById('moduleCount');
            if (moduleCountElement && moduleCountElement.parentElement) {
                moduleCountElement.parentElement.innerHTML = `${t.moduleCount}: <span id="moduleCount">${moduleCount}</span>`;
            }
            
            // 옵션 총합 제목
            const optionSummaryTitle = document.querySelector('.option-summary > div:first-child');
            if (optionSummaryTitle) {
                optionSummaryTitle.textContent = t.optionTotal;
            }
            
            // 효과 표시 업데이트 (모든 카드)
            for (let cardIndex = 0; cardIndex < 4; cardIndex++) {
                updateEffectDisplay(cardIndex);
            }
            
            // 옵션 총합 업데이트
            updateOptionSummary();

            // 컨텐츠 섹션 업데이트
            updateContentSections();
        }

        // 컨텐츠 섹션 텍스트 업데이트
        function updateContentSections() {
            const t = translations[currentLanguage];

            // 가이드 섹션
            document.getElementById('guideSectionTitle').textContent = t.guideTitle;
            document.getElementById('guideIntroText').textContent = t.guideIntro;
            document.getElementById('guideBasicSectionTitle').textContent = t.guideBasicTitle;
            document.getElementById('guideBasic1Text').textContent = t.guideBasic1;
            document.getElementById('guideBasic2Text').textContent = t.guideBasic2;
            document.getElementById('guideBasic3Text').textContent = t.guideBasic3;
            document.getElementById('guideBasic4Text').textContent = t.guideBasic4;
            document.getElementById('guideCustomSectionTitle').textContent = t.guideCustomTitle;
            document.getElementById('guideCustom1Text').textContent = t.guideCustom1;
            document.getElementById('guideCustom2Text').textContent = t.guideCustom2;
            document.getElementById('guideCustom3Text').textContent = t.guideCustom3;
            document.getElementById('guideCustom4Text').textContent = t.guideCustom4;
            document.getElementById('guideFeaturesSectionTitle').textContent = t.guideFeaturesTitle;
            document.getElementById('guideFeatures1Text').textContent = t.guideFeatures1;
            document.getElementById('guideFeatures2Text').textContent = t.guideFeatures2;
            document.getElementById('guideFeatures3Text').textContent = t.guideFeatures3;
            document.getElementById('guideFeatures4Text').textContent = t.guideFeatures4;

            // 효과 정보 섹션
            document.getElementById('effectInfoSectionTitle').textContent = t.effectInfoTitle;
            document.getElementById('effectInfoIntroText').textContent = t.effectInfoIntro;
            document.getElementById('effectTableNameHeader').textContent = t.effectTableName;
            document.getElementById('effectTableProbHeader').textContent = t.effectTableProb;
            document.getElementById('effectTableRangeHeader').textContent = t.effectTableRange;

            // 효과 테이블 업데이트
            const tbody = document.getElementById('effectTableBody');
            tbody.innerHTML = '';
            effects.forEach(effect => {
                const tr = document.createElement('tr');
                const displayName = t.effects[effect.name] || effect.name;
                const minValue = effect.tiers[0].toFixed(2);
                const maxValue = effect.tiers[14].toFixed(2);
                tr.innerHTML = `
                    <td>${displayName}</td>
                    <td>${effect.probability}%</td>
                    <td>${minValue}% - ${maxValue}%</td>
                `;
                tbody.appendChild(tr);
            });

            // FAQ 섹션
            document.getElementById('faqSectionTitle').textContent = t.faqTitle;
            document.getElementById('faq1QText').textContent = t.faq1Q;
            document.getElementById('faq1AText').textContent = t.faq1A;
            document.getElementById('faq2QText').textContent = t.faq2Q;
            document.getElementById('faq2AText').textContent = t.faq2A;
            document.getElementById('faq3QText').textContent = t.faq3Q;
            document.getElementById('faq3AText').textContent = t.faq3A;
            document.getElementById('faq4QText').textContent = t.faq4Q;
            document.getElementById('faq4AText').textContent = t.faq4A;
            document.getElementById('faq5QText').textContent = t.faq5Q;
            document.getElementById('faq5AText').textContent = t.faq5A;
        }

        // 언어 플래그 상태 업데이트
        function updateLanguageFlags() {
            document.querySelectorAll('.language-flag').forEach(flag => {
                flag.classList.remove('active');
                if (flag.dataset.lang === currentLanguage) {
                    flag.classList.add('active');
                }
            });
        }
        
        // 저장된 언어 설정 불러오기
        function loadSavedLanguage() {
            const savedLanguage = localStorage.getItem('nikkeLanguage');
            if (savedLanguage && translations[savedLanguage]) {
                currentLanguage = savedLanguage;
            } else {
                currentLanguage = 'ko'; // 기본값: 한국어
            }
            updateLanguageFlags();
        }
        
        // 모듈 사용 개수 카운터
        let moduleCount = 0;
        
        // 모듈 카운터 업데이트 함수
        function updateModuleCounter() {
            moduleCount++;
            document.getElementById('moduleCount').textContent = moduleCount;
        }
        
        // 옵션 총합 계산 및 업데이트 함수
        function updateOptionSummary() {
            const optionTotals = {};
            const optionTiers = {}; // 각 옵션의 티어 정보를 저장
            
            // 모든 카드의 효과를 순회하여 총합 계산
            for (let cardIndex = 0; cardIndex < 4; cardIndex++) {
                for (let slotIndex = 0; slotIndex < 3; slotIndex++) {
                    const effect = cardEffects[cardIndex][slotIndex];
                    if (effect) {
                        if (optionTotals[effect.name]) {
                            optionTotals[effect.name] += effect.value;
                            optionTiers[effect.name].push(effect.tier);
                        } else {
                            optionTotals[effect.name] = effect.value;
                            optionTiers[effect.name] = [effect.tier];
                        }
                    }
                }
            }
            
            // 총합 표시 업데이트
            const summaryElement = document.getElementById('optionSummary');
            summaryElement.innerHTML = '';
            
            const sortedOptions = Object.entries(optionTotals).sort(([nameA], [nameB]) => {
                // 우선순위 설정: 우월코드 대미지 증가, 공격력 증가를 앞에 배치
                const priorityOrder = ['우월코드 대미지 증가', '공격력 증가'];
                const indexA = priorityOrder.indexOf(nameA);
                const indexB = priorityOrder.indexOf(nameB);
                
                // 둘 다 우선순위 목록에 있는 경우
                if (indexA !== -1 && indexB !== -1) {
                    return indexA - indexB;
                }
                // A만 우선순위 목록에 있는 경우
                if (indexA !== -1) {
                    return -1;
                }
                // B만 우선순위 목록에 있는 경우
                if (indexB !== -1) {
                    return 1;
                }
                // 둘 다 우선순위 목록에 없는 경우 알파벳 순
                return nameA.localeCompare(nameB);
            });
            
            const t = translations[currentLanguage];
            
            if (sortedOptions.length === 0) {
                summaryElement.innerHTML = `<div style="text-align: center; color: #666; grid-column: 1 / -1;">${t.noActiveOptions}</div>`;
            } else {
                sortedOptions.forEach(([name, total]) => {
                    const optionDiv = document.createElement('div');
                    const tiers = optionTiers[name];
                    const displayName = t.effects[name] || `[${name}]`;
                    
                    // 티어에 따른 스타일 결정
                    let backgroundColor = 'white';
                    let nameColor = 'black';
                    let valueColor = 'black';
                    
                    if (tiers.includes(15)) {
                        // 15티어가 하나라도 있으면 15티어 스타일
                        backgroundColor = 'black';
                        nameColor = 'white';
                        valueColor = 'rgb(17, 167, 238)';
                    } else if (tiers.some(tier => tier >= 12 && tier <= 14)) {
                        // 12-14티어가 하나라도 있으면 12-14티어 스타일
                        backgroundColor = 'white';
                        nameColor = 'black';
                        valueColor = 'rgb(17, 167, 238)';
                    }
                    
                    optionDiv.style.cssText = `background: ${backgroundColor}; padding: 8px 12px; border-radius: 4px; border: 1px solid #ddd; text-align: center;`;
                    optionDiv.innerHTML = `<span style="color: ${nameColor}; font-weight: 500;">${displayName}</span><br><span style="color: ${valueColor}; font-weight: 600;">${total.toFixed(2)}%</span>`;
                    summaryElement.appendChild(optionDiv);
                });
            }
        }
        
        // 효과 데이터 정의
        const effects = [
            { name: "우월코드 대미지 증가", probability: 10, tiers: [9.54, 10.94, 12.34, 13.75, 15.15, 16.55, 17.95, 19.35, 20.75, 22.15, 23.56, 24.96, 26.36, 27.76, 29.16] },
            { name: "명중률 증가", probability: 12, tiers: [4.77, 5.47, 6.18, 6.88, 7.59, 8.29, 9.00, 9.70, 10.40, 11.11, 11.81, 12.52, 13.22, 13.93, 14.63] },
            { name: "최대 장탄 수 증가", probability: 12, tiers: [27.84, 31.95, 36.06, 40.17, 44.28, 48.39, 52.50, 56.60, 60.71, 64.82, 68.93, 73.04, 77.15, 81.26, 85.37] },
            { name: "공격력 증가", probability: 10, tiers: [4.77, 5.47, 6.18, 6.88, 7.59, 8.29, 9.00, 9.70, 10.40, 11.11, 11.81, 12.52, 13.22, 13.93, 14.63] },
            { name: "차지 대미지 증가", probability: 12, tiers: [4.77, 5.47, 6.18, 6.88, 7.59, 8.29, 9.00, 9.70, 10.40, 11.11, 11.81, 12.52, 13.22, 13.93, 14.63] },
            { name: "차지 속도 증가", probability: 12, tiers: [1.98, 2.28, 2.57, 2.86, 3.16, 3.45, 3.75, 4.04, 4.33, 4.63, 4.92, 5.21, 5.51, 5.80, 6.09] },
            { name: "크리티컬 확률 증가", probability: 10, tiers: [2.30, 2.64, 2.98, 3.32, 3.66, 4.00, 4.35, 4.69, 5.03, 5.37, 5.71, 6.05, 6.39, 6.73, 7.07] },
            { name: "방어력 증가", probability: 10, tiers: [4.77, 5.47, 6.18, 6.88, 7.59, 8.29, 9.00, 9.70, 10.40, 11.11, 11.81, 12.52, 13.22, 13.93, 14.63] },
            { name: "크리티컬 대미지 증가", probability: 12, tiers: [6.64, 7.62, 8.60, 9.58, 10.56, 11.54, 12.52, 13.50, 14.48, 15.46, 16.44, 17.42, 18.40, 19.38, 20.36] }
        ];

        // 슬롯별 확률
        const slotProbabilities = [100, 50, 30];

        // 티어별 확률 정의
        const tierProbabilities = [
            12, 12, 12, 12, 12,  // 1~5티어: 각각 12%
            7, 7, 7, 7, 7,       // 6~10티어: 각각 7%
            1, 1, 1, 1, 1        // 11~15티어: 각각 1%
        ];

        // 랜덤 티어 선택 함수
        function getRandomTier() {
            const totalWeight = tierProbabilities.reduce((sum, prob) => sum + prob, 0);
            const random = Math.random() * totalWeight;
            
            let currentWeight = 0;
            for (let i = 0; i < tierProbabilities.length; i++) {
                currentWeight += tierProbabilities[i];
                if (random <= currentWeight) {
                    return i; // 0-based index 반환
                }
            }
            return 0; // 기본값
        }

        // 랜덤 효과 생성 함수
        function generateRandomEffect(usedEffects = []) {
            // 사용된 효과들을 제외한 효과 목록 생성
            const availableEffects = effects.filter(effect => !usedEffects.includes(effect.name));
            
            if (availableEffects.length === 0) return null;

            // 가중치 랜덤 선택
            const totalWeight = availableEffects.reduce((sum, effect) => sum + effect.probability, 0);
            const random = Math.random() * totalWeight;
            
            let currentWeight = 0;
            for (const effect of availableEffects) {
                currentWeight += effect.probability;
                if (random <= currentWeight) {
                    // 티어별 확률에 따른 랜덤 선택
                    const tierIndex = getRandomTier();
                    const value = effect.tiers[tierIndex];
                    return {
                        name: effect.name,
                        value: value,
                        tier: tierIndex + 1
                    };
                }
            }
            
            return null;
        }

        // 카드별 효과 저장
        const cardEffects = [
            [null, null, null], // 카드 1
            [null, null, null], // 카드 2  
            [null, null, null], // 카드 3
            [null, null, null]  // 카드 4
        ];
        
        // 카드별 슬롯 잠금 상태 저장
        const cardLockStates = [
            [false, false, false], // 카드 1
            [false, false, false], // 카드 2
            [false, false, false], // 카드 3
            [false, false, false]  // 카드 4
        ];

        // 자물쇠 아이콘 클릭 이벤트 핸들러
        function toggleLock(cardIndex, slotIndex) {
            const currentState = cardLockStates[cardIndex][slotIndex];
            const currentEffect = cardEffects[cardIndex][slotIndex];

            // 효과와 티어가 모두 있는 경우에만 잠금 가능
            if (!currentState && currentEffect && currentEffect.name && currentEffect.tier) {
                // 커스텀 모드가 아닐 때만 모듈 비용 계산 및 차감
                if (!isCustomMode) {
                    // 현재 잠긴 개수 확인 (아직 이 슬롯은 잠기지 않은 상태)
                    const currentLockedCount = cardLockStates[cardIndex].filter(state => state).length;
                    const cost = [2, 3, 4][currentLockedCount]; // 0->1: 2개, 1->2: 3개, 2->3: 4개
                    moduleCount += cost;
                    document.getElementById('moduleCount').textContent = moduleCount;
                }

                // 잠금 해제 -> 잠금
                cardLockStates[cardIndex][slotIndex] = true;
            } else if (currentState) {
                // 잠금 -> 잠금 해제
                cardLockStates[cardIndex][slotIndex] = false;
            }

            updateEffectDisplay(cardIndex);

            // 커스텀 모드일 때 이벤트 리스너 재부착
            if (isCustomMode) {
                attachSelectChangeListeners();
            }
        }
        
        // 카드 내에서 사용 중인 효과 목록 가져오기
        function getUsedEffectsInCard(cardIndex, excludeSlotIndex = -1) {
            const usedEffects = [];
            for (let i = 0; i < 3; i++) {
                if (i !== excludeSlotIndex && cardEffects[cardIndex][i]) {
                    usedEffects.push(cardEffects[cardIndex][i].name);
                }
            }
            return usedEffects;
        }

        // 효과 텍스트 업데이트 함수
        function updateEffectDisplay(cardIndex) {
            const card = document.querySelectorAll('.card')[cardIndex];
            const textLines = card.querySelectorAll('.text-line');
            const t = translations[currentLanguage];

            // 커스텀 모드인 경우 Select 박스로 변환
            if (isCustomMode) {
                for (let i = 0; i < 3; i++) {
                    const effect = cardEffects[cardIndex][i];
                    const isLocked = cardLockStates[cardIndex][i];
                    const usedEffects = getUsedEffectsInCard(cardIndex, i);

                    // 효과 Select 박스 생성
                    const disabledAttr = isLocked ? ' disabled' : '';
                    let selectHTML = `<select class="effect-select" data-card="${cardIndex}" data-slot="${i}" style="width: 120px; padding: 4px; font-size: 11px; border: 2px solid var(--input-border); border-radius: 4px; background-color: var(--input-bg); color: var(--text-primary); margin-right: 4px;"${disabledAttr}>`;
                    selectHTML += `<option value="">${t.selectEffect}</option>`;

                    effects.forEach(eff => {
                        // 이미 사용 중인 효과는 제외
                        if (!usedEffects.includes(eff.name)) {
                            const selected = effect && effect.name === eff.name ? 'selected' : '';
                            const displayName = t.effects[eff.name] || eff.name;
                            selectHTML += `<option value="${eff.name}" ${selected}>${displayName}</option>`;
                        }
                    });

                    selectHTML += `</select>`;

                    // 수치 Select 박스 생성 (티어별 색상 적용)
                    let tierSelectStyle = 'width: 80px; padding: 4px; font-size: 11px; border: 2px solid var(--input-border); border-radius: 4px;';

                    // 현재 선택된 티어에 따른 색상 적용
                    if (effect && effect.tier) {
                        if (effect.tier === 15) {
                            tierSelectStyle += ' background-color: black; color: rgb(17, 167, 238);';
                        } else if (effect.tier >= 12 && effect.tier <= 14) {
                            tierSelectStyle += ' background-color: var(--input-bg); color: rgb(17, 167, 238);';
                        } else {
                            tierSelectStyle += ' background-color: var(--input-bg); color: var(--text-primary);';
                        }
                    } else {
                        tierSelectStyle += ' background-color: var(--input-bg); color: var(--text-primary);';
                    }

                    selectHTML += `<select class="tier-select" data-card="${cardIndex}" data-slot="${i}" style="${tierSelectStyle}"${disabledAttr}>`;
                    selectHTML += `<option value="">${t.selectValue}</option>`;

                    if (effect && effect.name) {
                        const effectData = effects.find(e => e.name === effect.name);
                        if (effectData) {
                            for (let tier = 1; tier <= 15; tier++) {
                                const selected = effect && effect.tier === tier ? 'selected' : '';
                                const valueText = effectData.tiers[tier - 1].toFixed(2) + '%';
                                selectHTML += `<option value="${tier}" data-tier="${tier}" ${selected}>${valueText}</option>`;
                            }
                        }
                    }

                    selectHTML += `</select>`;

                    // 자물쇠 아이콘 추가
                    const lockImage = isLocked ? 'images/lock.png' : 'images/unlock.png';
                    selectHTML += `<img class="lock-icon ${isLocked ? 'locked' : ''}" src="${lockImage}" onclick="toggleLock(${cardIndex}, ${i})" alt="${isLocked ? 'locked' : 'unlocked'}">`;

                    textLines[i].innerHTML = selectHTML;
                    textLines[i].style.backgroundColor = 'var(--input-bg)';
                    textLines[i].style.padding = '0 28px 0 16px';
                    textLines[i].style.justifyContent = 'center';
                }
            } else {
                // 일반 모드: 기존 텍스트 표시
                for (let i = 0; i < 3; i++) {
                    const effect = cardEffects[cardIndex][i];
                    const isLocked = cardLockStates[cardIndex][i];

                    if (effect) {
                        // 소수점 2자리까지 고정 표시
                        const formattedValue = effect.value.toFixed(2);
                        const effectName = t.effects[effect.name] || `[${effect.name}]`;

                        let effectHTML = '';
                        if (effect.tier == 15) {
                            effectHTML = `<span style="color: white;">${effectName}&nbsp;</span><span style="color: rgb(17, 167, 238);">${formattedValue}%</span>`;
                            textLines[i].style.backgroundColor = 'black';
                        }
                        else if (effect.tier >= 12 && effect.tier <= 14) {
                            effectHTML = `<span style="color: black;">${effectName}&nbsp;</span><span style="color: rgb(17, 167, 238);">${formattedValue}%</span>`;
                            textLines[i].style.backgroundColor = 'white';
                        } else {
                            effectHTML = `<span style="color: black;">${effectName} ${formattedValue}%</span>`;
                            textLines[i].style.backgroundColor = 'white';
                        }

                        // 자물쇠 아이콘 추가
                        const lockImage = isLocked ? 'images/lock.png' : 'images/unlock.png';
                        effectHTML += `<img class="lock-icon ${isLocked ? 'locked' : ''}" src="${lockImage}" onclick="toggleLock(${cardIndex}, ${i})" alt="${isLocked ? 'locked' : 'unlocked'}">`;
                        textLines[i].innerHTML = effectHTML;

                        // 텍스트 길이에 따른 폰트 크기 조정
                        const fullText = `${effectName} ${formattedValue}%`;
                        if (fullText.length > 20) {
                            textLines[i].style.fontSize = '11px';
                        } else if (fullText.length > 15) {
                            textLines[i].style.fontSize = '12px';
                        } else {
                            textLines[i].style.fontSize = '14px';
                        }

                    } else {
                        textLines[i].textContent = t.effectNotObtained;
                        textLines[i].style.backgroundColor = 'white';
                        textLines[i].style.color = '#666';
                        textLines[i].style.fontSize = '14px';
                    }
                }
            }
        }

        // 장비 개조 버튼 이벤트 (슬롯별 확률 적용, 11티어 고정)
        document.querySelectorAll('.modify-btn').forEach((button, index) => {
            button.addEventListener('click', () => {
                const card = button.closest('.card');
                card.classList.add('expanded');
                
                // 장비 개조 시 초기 효과 생성 (슬롯별 확률 적용, 11티어 고정)
                const usedEffects = [];
                
                // 기존에 잠긴 효과들을 사용된 효과 목록에 미리 추가
                for (let slotIndex = 0; slotIndex < 3; slotIndex++) {
                    if (cardLockStates[index][slotIndex] && cardEffects[index][slotIndex]) {
                        usedEffects.push(cardEffects[index][slotIndex].name);
                    }
                }
                
                for (let slotIndex = 0; slotIndex < 3; slotIndex++) {
                    // 잠긴 슬롯은 건너뛰기
                    if (cardLockStates[index][slotIndex]) {
                        continue;
                    }
                    
                    const slotChance = Math.random() * 100;
                    
                    if (slotChance <= slotProbabilities[slotIndex]) {
                        const availableEffects = effects.filter(effect => !usedEffects.includes(effect.name));
                        
                        if (availableEffects.length > 0) {
                            // 가중치 랜덤 선택
                            const totalWeight = availableEffects.reduce((sum, effect) => sum + effect.probability, 0);
                            const random = Math.random() * totalWeight;
                            
                            let currentWeight = 0;
                            for (const effect of availableEffects) {
                                currentWeight += effect.probability;
                                if (random <= currentWeight) {
                                    // 11티어 고정 (인덱스 10)
                                    const tierIndex = 10;
                                    const value = effect.tiers[tierIndex];
                                    cardEffects[index][slotIndex] = {
                                        name: effect.name,
                                        value: value,
                                        tier: tierIndex + 1
                                    };
                                    usedEffects.push(effect.name);
                                    break;
                                }
                            }
                        } else {
                            cardEffects[index][slotIndex] = null;
                        }
                    } else {
                        cardEffects[index][slotIndex] = null;
                    }
                }
                
                updateEffectDisplay(index);
                updateModuleCounter();
                updateOptionSummary();
            });
        });

        // 효과 변경 버튼 이벤트
        document.querySelectorAll('.effect-btn').forEach((button, index) => {
            button.addEventListener('click', () => {
                // 상위 티어 보호 체크박스가 체크되어 있는지 확인
                const isProtectEnabled = document.getElementById('protectHighTier').checked;

                // 현재 옵션 중 12-15티어이고 잠기지 않은 옵션이 있는지 확인
                const hasHighTierUnlocked = cardEffects[index].some((effect, slotIndex) =>
                    effect && effect.tier >= 12 && effect.tier <= 15 && !cardLockStates[index][slotIndex]
                );

                // 보호가 활성화되어 있고 상위 티어가 존재하면 경고
                if (isProtectEnabled && hasHighTierUnlocked) {
                    const confirmed = confirm(translations[currentLanguage].confirmHighTier);
                    if (!confirmed) {
                        return; // 사용자가 No를 선택하면 실행 중단
                    }
                }
                
                const usedEffects = [];
                
                // 잠긴 슬롯 개수에 따른 추가 모듈 비용
                const lockedCount = cardLockStates[index].filter(state => state).length;
                const additionalCost = lockedCount > 0 ? [1, 2][lockedCount - 1] || 0 : 0;
                
                // 먼저 모든 잠긴 슬롯의 효과를 사용된 효과 목록에 추가
                for (let slotIndex = 0; slotIndex < 3; slotIndex++) {
                    if (cardLockStates[index][slotIndex] && cardEffects[index][slotIndex]) {
                        usedEffects.push(cardEffects[index][slotIndex].name);
                    }
                }
                
                // 각 슬롯에 대해 확률 계산 (잠긴 슬롯은 제외)
                for (let slotIndex = 0; slotIndex < 3; slotIndex++) {
                    if (cardLockStates[index][slotIndex]) {
                        // 잠긴 슬롯은 건너뛰기
                        continue;
                    }
                    
                    const slotChance = Math.random() * 100;
                    
                    if (slotChance <= slotProbabilities[slotIndex]) {
                        const effect = generateRandomEffect(usedEffects);
                        if (effect) {
                            cardEffects[index][slotIndex] = effect;
                            usedEffects.push(effect.name);
                        } else {
                            cardEffects[index][slotIndex] = null;
                        }
                    } else {
                        cardEffects[index][slotIndex] = null;
                    }
                }
                
                updateEffectDisplay(index);
                updateModuleCounter();
                
                // 잠긴 슬롯이 있으면 추가 모듈 비용 적용
                if (additionalCost > 0) {
                    moduleCount += additionalCost;
                    document.getElementById('moduleCount').textContent = moduleCount;
                }
                
                updateOptionSummary();
            });
        });

        // 수치 재설정 버튼 이벤트 (효과 고정, 티어만 랜덤 재설정)
        document.querySelectorAll('.reset-btn').forEach((button, index) => {
            button.addEventListener('click', () => {
                // 상위 티어 보호 체크박스가 체크되어 있는지 확인
                const isProtectEnabled = document.getElementById('protectHighTier').checked;

                // 현재 옵션 중 12-15티어이고 잠기지 않은 옵션이 있는지 확인
                const hasHighTierUnlocked = cardEffects[index].some((effect, slotIndex) =>
                    effect && effect.tier >= 12 && effect.tier <= 15 && !cardLockStates[index][slotIndex]
                );

                // 보호가 활성화되어 있고 상위 티어가 존재하면 경고
                if (isProtectEnabled && hasHighTierUnlocked) {
                    const confirmed = confirm(translations[currentLanguage].confirmHighTier);
                    if (!confirmed) {
                        return; // 사용자가 No를 선택하면 실행 중단
                    }
                }
                
                // 잠긴 슬롯 개수에 따른 추가 모듈 비용
                const lockedCount = cardLockStates[index].filter(state => state).length;
                const additionalCost = lockedCount > 0 ? [1, 2][lockedCount - 1] || 0 : 0;
                
                // 기존 효과가 있는 슬롯의 티어만 재설정 (잠긴 슬롯은 제외)
                for (let slotIndex = 0; slotIndex < 3; slotIndex++) {
                    if (cardLockStates[index][slotIndex]) {
                        continue; // 잠긴 슬롯은 건너뜀
                    }
                    
                    const currentEffect = cardEffects[index][slotIndex];
                    if (currentEffect) {
                        // 현재 효과의 종류는 유지하고 티어만 랜덤으로 재설정
                        const effectData = effects.find(e => e.name === currentEffect.name);
                        if (effectData) {
                            const tierIndex = getRandomTier();
                            const value = effectData.tiers[tierIndex];
                            cardEffects[index][slotIndex] = {
                                name: currentEffect.name,
                                value: value,
                                tier: tierIndex + 1
                            };
                        }
                    }
                }
                updateEffectDisplay(index);
                updateModuleCounter();
                
                // 잠긴 슬롯이 있으면 추가 모듈 비용 적용
                if (additionalCost > 0) {
                    moduleCount += additionalCost;
                    document.getElementById('moduleCount').textContent = moduleCount;
                }
                
                updateOptionSummary();
            });
        });
        
        // 초기화 버튼 이벤트
        document.getElementById('resetAllBtn').addEventListener('click', () => {
            // 모든 카드의 효과 초기화
            for (let cardIndex = 0; cardIndex < 4; cardIndex++) {
                cardEffects[cardIndex] = [null, null, null];
                cardLockStates[cardIndex] = [false, false, false];
                // 모든 카드를 초기 상태로 변경
                const cards = document.querySelectorAll('.card');
                cards[cardIndex].classList.remove('expanded');
            }

            // 모듈 개수 초기화
            moduleCount = 0;
            document.getElementById('moduleCount').textContent = moduleCount;

            // 화면 업데이트
            for (let cardIndex = 0; cardIndex < 4; cardIndex++) {
                updateEffectDisplay(cardIndex);
            }

            // 커스텀 모드일 때 이벤트 리스너 재부착
            if (isCustomMode) {
                attachSelectChangeListeners();
            }

            updateOptionSummary();
        });
        
        // 초기화 버튼 호버 효과
        document.getElementById('resetAllBtn').addEventListener('mouseenter', function() {
            this.style.backgroundColor = '#c82333';
        });

        document.getElementById('resetAllBtn').addEventListener('mouseleave', function() {
            this.style.backgroundColor = '#dc3545';
        });

        // 커스텀 버튼 호버 효과
        document.getElementById('customModeBtn').addEventListener('mouseenter', function() {
            if (isCustomMode) {
                this.style.backgroundColor = '#c82333'; // 빨간색 호버
            } else {
                this.style.backgroundColor = '#1e7e34'; // 녹색 호버
            }
        });

        document.getElementById('customModeBtn').addEventListener('mouseleave', function() {
            if (isCustomMode) {
                this.style.backgroundColor = '#dc3545'; // 빨간색
            } else {
                this.style.backgroundColor = '#28a745'; // 녹색
            }
        });
        
        // 언어 선택기 이벤트 리스너
        document.querySelectorAll('.language-flag').forEach(flag => {
            flag.addEventListener('click', () => {
                const selectedLang = flag.dataset.lang;
                if (selectedLang !== currentLanguage) {
                    changeLanguage(selectedLang);
                }
            });
        });
        
        // 다크모드 관련 함수
        function initTheme() {
            const savedTheme = localStorage.getItem('nikkeTheme') || 'light';
            applyTheme(savedTheme);
        }

        function applyTheme(theme) {
            const html = document.documentElement;
            const themeIcon = document.querySelector('.theme-icon');

            if (theme === 'dark') {
                html.setAttribute('data-theme', 'dark');
                themeIcon.textContent = '☀️';
                localStorage.setItem('nikkeTheme', 'dark');
            } else {
                html.removeAttribute('data-theme');
                themeIcon.textContent = '🌙';
                localStorage.setItem('nikkeTheme', 'light');
            }
        }

        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            applyTheme(newTheme);
        }

        // 다크모드 토글 버튼 이벤트 (데스크탑)
        document.getElementById('themeToggle').addEventListener('click', toggleTheme);

        // 다크모드 토글 버튼 이벤트 (모바일)
        document.getElementById('themeToggleMobile').addEventListener('click', toggleTheme);

        // 카드 상태 업데이트 함수 (버튼 표시 제어)
        function updateCardState(cardIndex) {
            const card = document.querySelectorAll('.card')[cardIndex];
            const hasAnyEffect = cardEffects[cardIndex].some(effect => effect !== null);

            if (isCustomMode) {
                // 커스텀 모드: 모든 버튼 숨김
                card.classList.add('custom-mode');
            } else {
                // 일반 모드: custom-mode 클래스 제거
                card.classList.remove('custom-mode');

                // 효과가 있으면 expanded 클래스 추가
                if (hasAnyEffect) {
                    card.classList.add('expanded');
                } else {
                    card.classList.remove('expanded');
                }
            }
        }

        // 커스텀 모드 토글 함수
        function toggleCustomMode() {
            isCustomMode = !isCustomMode;
            const btn = document.getElementById('customModeBtn');
            const t = translations[currentLanguage];

            if (isCustomMode) {
                // 커스텀 모드 활성화 - 빨간색, 종료 표시
                btn.style.backgroundColor = '#dc3545';
                btn.textContent = t.customModeOff;
            } else {
                // 일반 모드 - 녹색, 시작 표시
                btn.style.backgroundColor = '#28a745';
                btn.textContent = t.customModeOn;
            }

            // 모든 카드의 효과 표시 업데이트
            for (let i = 0; i < 4; i++) {
                updateEffectDisplay(i);
                updateCardState(i);
            }

            // 커스텀 모드에서 Select 변경 이벤트 리스너 추가
            if (isCustomMode) {
                attachSelectChangeListeners();
            }
        }

        // Select 변경 이벤트 리스너 추가
        function attachSelectChangeListeners() {
            // 효과 Select 변경 이벤트
            document.querySelectorAll('.effect-select').forEach(select => {
                select.addEventListener('change', function() {
                    const cardIndex = parseInt(this.dataset.card);
                    const slotIndex = parseInt(this.dataset.slot);
                    const selectedEffectName = this.value;

                    if (selectedEffectName) {
                        const effectData = effects.find(e => e.name === selectedEffectName);
                        if (effectData) {
                            // 현재 슬롯의 티어를 유지, 없으면 11티어로 설정
                            const currentEffect = cardEffects[cardIndex][slotIndex];
                            const tierToUse = currentEffect && currentEffect.tier ? currentEffect.tier : 11;
                            const tierIndex = tierToUse - 1;

                            cardEffects[cardIndex][slotIndex] = {
                                name: effectData.name,
                                value: effectData.tiers[tierIndex],
                                tier: tierToUse
                            };

                            // 다른 슬롯의 선택 옵션 업데이트를 위해 다시 렌더링
                            updateEffectDisplay(cardIndex);

                            // 이벤트 리스너 재부착
                            attachSelectChangeListeners();

                            // 카드 상태 업데이트 (버튼 표시 제어용)
                            updateCardState(cardIndex);

                            updateOptionSummary();
                        }
                    } else {
                        cardEffects[cardIndex][slotIndex] = null;

                        // 다른 슬롯의 선택 옵션 업데이트를 위해 다시 렌더링
                        updateEffectDisplay(cardIndex);

                        // 이벤트 리스너 재부착
                        attachSelectChangeListeners();

                        // 카드 상태 업데이트 (버튼 표시 제어용)
                        updateCardState(cardIndex);

                        updateOptionSummary();
                    }
                });
            });

            // 티어 Select 변경 이벤트
            document.querySelectorAll('.tier-select').forEach(select => {
                select.addEventListener('change', function() {
                    const cardIndex = parseInt(this.dataset.card);
                    const slotIndex = parseInt(this.dataset.slot);
                    const selectedTier = parseInt(this.value);
                    const currentEffect = cardEffects[cardIndex][slotIndex];

                    if (selectedTier && currentEffect && currentEffect.name) {
                        const effectData = effects.find(e => e.name === currentEffect.name);
                        if (effectData) {
                            const tierIndex = selectedTier - 1;
                            cardEffects[cardIndex][slotIndex] = {
                                name: effectData.name,
                                value: effectData.tiers[tierIndex],
                                tier: selectedTier
                            };

                            // Select 박스 스타일 즉시 업데이트
                            if (selectedTier === 15) {
                                this.style.backgroundColor = 'black';
                                this.style.color = 'rgb(17, 167, 238)';
                            } else if (selectedTier >= 12 && selectedTier <= 14) {
                                this.style.backgroundColor = 'var(--input-bg)';
                                this.style.color = 'rgb(17, 167, 238)';
                            } else {
                                this.style.backgroundColor = 'var(--input-bg)';
                                this.style.color = 'var(--text-primary)';
                            }

                            // 카드 상태 업데이트 (버튼 표시 제어용)
                            updateCardState(cardIndex);

                            updateOptionSummary();
                        }
                    } else {
                        // "수치" 기본값을 선택한 경우 스타일 초기화
                        this.style.backgroundColor = 'var(--input-bg)';
                        this.style.color = 'var(--text-primary)';
                    }
                });
            });
        }

        // 커스텀 모드 버튼 이벤트
        document.getElementById('customModeBtn').addEventListener('click', toggleCustomMode);

        // 페이지 로드 시 언어 설정 불러오기 및 초기화
        document.addEventListener('DOMContentLoaded', () => {
            initTheme();
            loadSavedLanguage();
            updateAllTexts();
            updateContentSections();
        });
    </script>
</body>
</html>